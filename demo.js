// Copyright 2017 Zerocoin Electric Coin Company LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.


// =================================
// START: Web3 deploy code
// =================================
var tracker    = null;
var atumToken_abi = web3.eth.contract([{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"v","type":"uint256"},{"name":"n","type":"uint256"}],"name":"rightShift","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"left","type":"bytes32"},{"name":"right","type":"bytes32"}],"name":"combine","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"shieldedTxCapacity","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"shieldedTransferCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"cm","type":"bytes32"}],"name":"getWitness","outputs":[{"name":"","type":"uint256"},{"name":"","type":"bytes32[]"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"available","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"unshieldingCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"proof","type":"bytes"},{"name":"send_nf","type":"bytes32"},{"name":"cm","type":"bytes32"},{"name":"value","type":"uint64"}],"name":"shield","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":false,"inputs":[{"name":"v","type":"uint256"},{"name":"n","type":"uint256"}],"name":"leftShift","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[],"name":"capacity","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"shieldedTxAvailable","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"depth","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"replayNonce","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"getEmptyRoots","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"signature","type":"bytes"},{"name":"to","type":"address"},{"name":"value","type":"uint256"},{"name":"nonce","type":"uint256"},{"name":"reward","type":"uint256"}],"name":"metaTransfer","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[],"name":"shieldingCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"proof","type":"bytes"},{"name":"spend_nf","type":"bytes32"},{"name":"cm","type":"bytes32"},{"name":"rt","type":"bytes32"},{"name":"value","type":"uint64"}],"name":"unshield","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[{"name":"cm","type":"bytes32"}],"name":"commitmentExists","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"signature","type":"bytes"},{"name":"nonce","type":"uint256"},{"name":"reward","type":"uint256"},{"name":"proof","type":"bytes"},{"name":"anchor","type":"bytes32"},{"name":"spend_nf_1","type":"bytes32"},{"name":"spend_nf_2","type":"bytes32"},{"name":"send_nf_1","type":"bytes32"},{"name":"send_nf_2","type":"bytes32"},{"name":"cm_1","type":"bytes32"},{"name":"cm_2","type":"bytes32"},{"name":"blob","type":"string"}],"name":"metaShieldedTransfer","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[],"name":"size","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"cm","type":"bytes32"}],"name":"addCommitment","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[{"name":"depth","type":"uint256"}],"name":"getEmptyRoot","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"proof","type":"bytes"},{"name":"anchor","type":"bytes32"},{"name":"spend_nf_1","type":"bytes32"},{"name":"spend_nf_2","type":"bytes32"},{"name":"send_nf_1","type":"bytes32"},{"name":"send_nf_2","type":"bytes32"},{"name":"cm_1","type":"bytes32"},{"name":"cm_2","type":"bytes32"},{"name":"blob","type":"string"}],"name":"shieldedTransfer","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[],"name":"balance","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"signer","type":"address"},{"name":"recipient","type":"address"},{"name":"value","type":"uint256"}],"name":"transfer","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"},{"name":"nonce","type":"uint256"},{"name":"reward","type":"uint256"}],"name":"metaTransferHash","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"cm","type":"bytes32"}],"name":"getLeafIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"atumToken_TREE_DEPTH","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[{"name":"index","type":"uint256"}],"name":"getCommitmentAtLeafIndex","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"root","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"inputs":[{"name":"ownerBalance","type":"uint256"},{"name":"tokenName","type":"string"}],"payable":false,"type":"constructor","stateMutability":"nonpayable"},{"payable":false,"type":"fallback","stateMutability":"nonpayable"},{"anonymous":false,"inputs":[{"indexed":true,"name":"signer","type":"address"},{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"LogTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"LogMint","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"uuid","type":"bytes32"}],"name":"LogShielding","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"uuid","type":"bytes32"}],"name":"LogUnshielding","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"uuid_1","type":"bytes32"},{"indexed":false,"name":"uuid_2","type":"bytes32"},{"indexed":false,"name":"blob","type":"string"}],"name":"LogShieldedTransfer","type":"event"}]);
var code='0x6060604052600060055534156200001257fe5b60405162003aa738038062003aa7833981016040528080519060200190919080518201919050505b601d5b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b6200008a6200058b565b809050604051809103906000f0801515620000a157fe5b600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550806002819055508060020a60038190555062000111816200025064010000000002620027ec176401000000009004565b5b5081600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555080600890805190602001906200016f9291906200059c565b50600c60ff16600a0a620f4240026009819055506200018d6200058b565b809050604051809103906000f0801515620001a457fe5b600f60006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600f60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16601060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5050620006b6565b60006000600060010291506004805480600101828162000271919062000623565b916000526020600020900160005b8490919091509060001916905550600090505b600183038110156200030157620002be8283620003076401000000000262000e0f176401000000009004565b915060048054806001018281620002d6919062000623565b916000526020600020900160005b84909190915090600019169055505b808060010191505062000292565b5b505050565b60006200031362000652565b60006040604051805910620003255750595b908082528060200260200182016040525b509150600090505b6020811015620003c85784816020811015156200035757fe5b1a7f01000000000000000000000000000000000000000000000000000000000000000282828151811015156200038957fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053505b80806001019150506200033e565b600090505b60208110156200045a578381602081101515620003e657fe5b1a7f01000000000000000000000000000000000000000000000000000000000000000282602083018151811015156200041b57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053505b8080600101915050620003cd565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633319f70b836000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180806020018281038252838181518152602001915080519060200190808383600083146200051f575b8051825260208311156200051f57602082019150602081019050602083039250620004f9565b505050905090810190601f1680156200054c5780820380516001836020036101000a031916815260200191505b5092505050602060405180830381600087803b15156200056857fe5b60325a03f115156200057657fe5b5050506040518051905092505b505092915050565b604051610add8062002fca83390190565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620005df57805160ff191683800117855562000610565b8280016001018555821562000610579182015b828111156200060f578251825591602001919060010190620005f2565b5b5090506200061f919062000666565b5090565b8154818355818115116200064d578183600052602060002091820191016200064c91906200068e565b5b505050565b602060405190810160405280600081525090565b6200068b91905b80821115620006875760008160009055506001016200066d565b5090565b90565b620006b391905b80821115620006af57600081600090555060010162000695565b5090565b90565b61290480620006c66000396000f300606060405236156101c0576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde03146101d95780630af0b1321461027257806318160ddd146102af5780631d48f5e9146102d5578063313ce5671461032257806334298c211461034e57806341a42bea1461037457806347e722461461039a57806348a0d754146104285780634e3cb2e91461044e5780635967caa2146104745780635ae60499146104fb5780635cfc1a51146105385780635f95f1d41461055e578063631c56ef1461058457806367d407df146105aa5780636def0cbe146105f457806370a082311461066957806371316b33146106b35780637a14db1614610747578063835278b71461076d57806386307865146108015780638da5cb5b1461083d5780638e76bb871461088f578063949d225d146109dc5780639f7ad1d114610a02578063a06f097714610a26578063ad8acd7214610a62578063b69ef8a814610b5a578063beabacc814610b80578063bf4b72e314610bde578063c8c5051514610c4b578063ce0a857214610c83578063d0316c5014610ca9578063ebf0c71714610ce5578063f2fde38b14610d13575b34156101c857fe5b6101d75b6101d4610d49565b5b565b005b34156101e157fe5b6101e9610d51565b6040518080602001828103825283818151815260200191508051906020019080838360008314610238575b80518252602083111561023857602082019150602081019050602083039250610214565b505050905090810190601f1680156102645780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561027a57fe5b6102996004808035906020019091908035906020019091905050610def565b6040518082815260200191505060405180910390f35b34156102b757fe5b6102bf610e09565b6040518082815260200191505060405180910390f35b34156102dd57fe5b61030460048080356000191690602001909190803560001916906020019091905050610e0f565b60405180826000191660001916815260200191505060405180910390f35b341561032a57fe5b610332611082565b604051808260ff1660ff16815260200191505060405180910390f35b341561035657fe5b61035e611087565b6040518082815260200191505060405180910390f35b341561037c57fe5b6103846110a3565b6040518082815260200191505060405180910390f35b34156103a257fe5b6103bc6004808035600019169060200190919050506110a9565b6040518083815260200180602001828103825283818151815260200191508051906020019060200280838360008314610414575b805182526020831115610414576020820191506020810190506020830392506103f0565b505050905001935050505060405180910390f35b341561043057fe5b610438611192565b6040518082815260200191505060405180910390f35b341561045657fe5b61045e6111a1565b6040518082815260200191505060405180910390f35b341561047c57fe5b6104f9600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035600019169060200190919080356000191690602001909190803567ffffffffffffffff169060200190919050506111a7565b005b341561050357fe5b61052260048080359060200190919080359060200190919050506114f7565b6040518082815260200191505060405180910390f35b341561054057fe5b610548611508565b6040518082815260200191505060405180910390f35b341561056657fe5b61056e611513565b6040518082815260200191505060405180910390f35b341561058c57fe5b610594611527565b6040518082815260200191505060405180910390f35b34156105b257fe5b6105de600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611532565b6040518082815260200191505060405180910390f35b34156105fc57fe5b61060461154a565b6040518080602001828103825283818151815260200191508051906020019060200280838360008314610656575b80518252602083111561065657602082019150602081019050602083039250610632565b5050509050019250505060405180910390f35b341561067157fe5b61069d600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506115ad565b6040518082815260200191505060405180910390f35b34156106bb57fe5b610745600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919080359060200190919080359060200190919050506115c5565b005b341561074f57fe5b610757611733565b6040518082815260200191505060405180910390f35b341561077557fe5b6107ff600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803560001916906020019091908035600019169060200190919080356000191690602001909190803567ffffffffffffffff16906020019091905050611739565b005b341561080957fe5b610823600480803560001916906020019091905050611a2b565b604051808215151515815260200191505060405180910390f35b341561084557fe5b61084d611a55565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561089757fe5b6109da600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001909190803590602001909190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919080356000191690602001909190803560001916906020019091908035600019169060200190919080356000191690602001909190803560001916906020019091908035600019169060200190919080356000191690602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050611a7b565b005b34156109e457fe5b6109ec611bef565b6040518082815260200191505060405180910390f35b3415610a0a57fe5b610a24600480803560001916906020019091905050611bfa565b005b3415610a2e57fe5b610a446004808035906020019091905050611c84565b60405180826000191660001916815260200191505060405180910390f35b3415610a6a57fe5b610b58600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919080356000191690602001909190803560001916906020019091908035600019169060200190919080356000191690602001909190803560001916906020019091908035600019169060200190919080356000191690602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050611cbd565b005b3415610b6257fe5b610b6a6120a2565b6040518082815260200191505060405180910390f35b3415610b8857fe5b610bdc600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050612161565b005b3415610be657fe5b610c2d600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091908035906020019091908035906020019091905050612346565b60405180826000191660001916815260200191505060405180910390f35b3415610c5357fe5b610c6d600480803560001916906020019091905050612427565b6040518082815260200191505060405180910390f35b3415610c8b57fe5b610c93612462565b6040518082815260200191505060405180910390f35b3415610cb157fe5b610cc76004808035906020019091905050612467565b60405180826000191660001916815260200191505060405180910390f35b3415610ced57fe5b610cf561249b565b60405180826000191660001916815260200191505060405180910390f35b3415610d1b57fe5b610d47600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506124b0565b005b60006000fd5b565b60088054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610de75780601f10610dbc57610100808354040283529160200191610de7565b820191906000526020600020905b815481529060010190602001808311610dca57829003601f168201915b505050505081565b60008160020a83811515610dff57fe5b0490505b92915050565b60095481565b6000610e196127c4565b60006040604051805910610e2a5750595b908082528060200260200182016040525b509150600090505b6020811015610ec9578481602081101515610e5a57fe5b1a7f0100000000000000000000000000000000000000000000000000000000000000028282815181101515610e8b57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053505b8080600101915050610e43565b600090505b6020811015610f57578381602081101515610ee557fe5b1a7f0100000000000000000000000000000000000000000000000000000000000000028260208301815181101515610f1957fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053505b8080600101915050610ece565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633319f70b836000604051602001526040518263ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825283818151815260200191508051906020019080838360008314611019575b80518252602083111561101957602082019150602081019050602083039250610ff5565b505050905090810190601f1680156110455780820380516001836020036101000a031916815260200191505b5092505050602060405180830381600087803b151561106057fe5b60325a03f1151561106d57fe5b5050506040518051905092505b505092915050565b600c81565b60006002611093611508565b81151561109c57fe5b0490505b90565b600e5481565b60006110b36127d8565b600060006110bf6127d8565b600060006000600660008a600019166000191681526020019081526020016000205495506110ef60008711612553565b6001860394506002546040518059106111055750595b908082528060200260200182016040525b50935060009250849150600090505b600254831015611180576111426001831884806001019550612564565b848280600101935081518110151561115657fe5b906020019060200201906000191690816000191681525050611179826001610def565b9150611125565b8484975097505b505050505050915091565b60006005546003540390505b90565b600d5481565b6111fc8167ffffffffffffffff16600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015612553565b61122360006011600086600019166000191681526020019081526020016000205414612553565b61123561122f83611a2b565b15612553565b611399601060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663e088659e868686866000604051602001526040518563ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001856000191660001916815260200184600019166000191681526020018367ffffffffffffffff1667ffffffffffffffff168152602001828103825286818151815260200191508051906020019080838360008314611333575b8051825260208311156113335760208201915060208101905060208303925061130f565b505050905090810190601f16801561135f5780820380516001836020036101000a031916815260200191505b5095505050505050602060405180830381600087803b151561137d57fe5b60325a03f1151561138a57fe5b50505060405180519050612620565b6113a282611bfa565b600160116000856000191660001916815260200190815260200160002081905550611416600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548267ffffffffffffffff16612631565b600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055503373ffffffffffffffffffffffffffffffffffffffff167fe98b540e92df7848084ffd671d0e51f24307beb49f2ab01e35bb695ceb8aba6782846040518082600019166000191681526020019150506040518091039020604051808367ffffffffffffffff16815260200182600019166000191681526020019250505060405180910390a2600c600081548092919060010191905055505b50505050565b60008160020a830290505b92915050565b600060035490505b90565b6000600e54611520611087565b0390505b90565b600060025490505b90565b600b6020528060005260406000206000915090505481565b6115526127d8565b60048054806020026020016040519081016040528092919081815260200182805480156115a257602002820191906000526020600020905b8154600019168152602001906001019080831161158a575b505050505090505b90565b600a6020528060005260406000206000915090505481565b600060006115d586868686612346565b91506115e18288612651565b905061161c600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415612553565b611666600b60008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548514612553565b600b60008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081548092919060010191905055506117096116c28685612798565b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015612553565b611714818787612161565b600083111561172957611728813385612161565b5b5b50505050505050565b600c5481565b61176060006011600087600019166000191681526020019081526020016000205414612553565b61177161176c84611a2b565b612553565b6118d5601060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dafca47a878786866000604051602001526040518563ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001856000191660001916815260200184600019166000191681526020018367ffffffffffffffff1667ffffffffffffffff16815260200182810382528681815181526020019150805190602001908083836000831461186f575b80518252602083111561186f5760208201915060208101905060208303925061184b565b505050905090810190601f16801561189b5780820380516001836020036101000a031916815260200191505b5095505050505050602060405180830381600087803b15156118b957fe5b60325a03f115156118c657fe5b50505060405180519050612620565b600160116000866000191660001916815260200190815260200160002081905550611949600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548267ffffffffffffffff16612798565b600a60003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055503373ffffffffffffffffffffffffffffffffffffffff167f77c10afc47cf7753a7d1b501cd07d1720103713089bf4f7ba501bebda81cd4b782856040518082600019166000191681526020019150506040518091039020604051808367ffffffffffffffff16815260200182600019166000191681526020019250505060405180910390a2600d600081548092919060010191905055505b5050505050565b6000600060066000846000191660001916815260200190815260200160002054141590505b919050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60006000611a8d600060008f8f612346565b9150611a99828f612651565b9050611ad4600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415612553565b611b1e600b60008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548e14612553565b600b60008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008154809291906001019190505550611bb88c600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015612553565b60008c1115611bcd57611bcc81338e612161565b5b611bde8b8b8b8b8b8b8b8b8b611cbd565b5b5050505050505050505050505050565b600060055490505b90565b6000611c2360006006600085600019166000191681526020019081526020016000205414612553565b611c3260035460055410612553565b60056000815460010191905081905590508060066000846000191660001916815260200190815260200160002081905550816007600083815260200190815260200160002081600019169055505b5050565b6000611c966004805490508310612553565b600482815481101515611ca557fe5b906000526020600020900160005b505490505b919050565b611ce460006011600088600019166000191681526020019081526020016000205414612553565b611d0b60006011600087600019166000191681526020019081526020016000205414612553565b611d326000601160008a600019166000191681526020019081526020016000205414612553565b611d5960006011600089600019166000191681526020019081526020016000205414612553565b611d6b611d6584611a2b565b15612553565b611d7d611d7783611a2b565b15612553565b611f15601060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663794f69e38b8b8b8b8b8b8b8b6000604051602001526040518963ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001896000191660001916815260200188600019166000191681526020018760001916600019168152602001866000191660001916815260200185600019166000191681526020018460001916600019168152602001836000191660001916815260200182810382528a818151815260200191508051906020019080838360008314611eab575b805182526020831115611eab57602082019150602081019050602083039250611e87565b505050905090810190601f168015611ed75780820380516001836020036101000a031916815260200191505b509950505050505050505050602060405180830381600087803b1515611ef957fe5b60325a03f11515611f0657fe5b50505060405180519050612620565b611f1e83611bfa565b611f2782611bfa565b6001601160008760001916600019168152602001908152602001600020819055506001601160008660001916600019168152602001908152602001600020819055503373ffffffffffffffffffffffffffffffffffffffff167f875e49ba5ff05ceaaa19d557065e0dce706f44346e07644011aae6ffce7786b384604051808260001916600019168152602001915050604051809103902084604051808260001916600019168152602001915050604051809103902084604051808460001916600019168152602001836000191660001916815260200180602001828103825283818151815260200191508051906020019080838360008314612049575b80518252602083111561204957602082019150602081019050602083039250612025565b505050905090810190601f1680156120755780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a2600e600081548092919060010191905055505b505050505050505050565b60003073ffffffffffffffffffffffffffffffffffffffff166370a08231336000604051602001526040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b151561214457fe5b60325a03f1151561215157fe5b5050506040518051905090505b90565b6121ac81600a60008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015612553565b6121f5600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482612631565b600a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550612281600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482612798565b600a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f6eabe333476233fd382224f233210cb808a7bc4c4de64f9d76628bf63c677b1a846040518082815260200191505060405180910390a45b505050565b60003085858585604051808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c01000000000000000000000000028152601401807f6d6574615472616e736665720000000000000000000000000000000000000000815250600c018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166c0100000000000000000000000002815260140184815260200183815260200182815260200195505050505050604051809103902090505b949350505050565b6000600060066000846000191660001916815260200190815260200160002054905061245560008211612553565b6001810191505b50919050565b601d81565b600060006124786005548410612553565b600183019050600760008281526020019081526020016000205491505b50919050565b60006124aa6000600254612564565b90505b90565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561250d5760006000fd5b80600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b50565b8015156125605760006000fd5b5b50565b600060006000600061257686866114f7565b6005541115156125a65760048581548110151561258f57fe5b906000526020600020900160005b50549350612617565b60008514156125d05760018601925060076000848152602001908152602001600020549350612617565b6125e76125de8760016114f7565b60018703612564565b915061260360016125f98860016114f7565b0160018703612564565b905061260f8282610e0f565b9350612617565b5b50505092915050565b80151561262d5760006000fd5b5b50565b6000600061264183851015612620565b82840390508091505b5092915050565b60006000600060006041855114151561266d576000935061278f565b6020850151925060408501519150606085015160001a9050601b8160ff16101561269857601b810190505b601b8160ff16141580156126b05750601c8160ff1614155b156126be576000935061278f565b60018660405180807f19457468657265756d205369676e6564204d6573736167653a0a333200000000815250601c0182600019166000191681526020019150506040518091039020828585604051806000526020016040526000604051602001526040518085600019166000191681526020018460ff1660ff1681526020018360001916600019168152602001826000191660001916815260200194505050505060206040516020810390808403906000866161da5a03f1151561277e57fe5b505060206040510351935061278f565b5b50505092915050565b6000600082840190506127b98482101580156127b45750838210155b612620565b8091505b5092915050565b602060405190810160405280600081525090565b602060405190810160405280600081525090565b60006000600060010291506004805480600101828161280b9190612887565b916000526020600020900160005b8490919091509060001916905550600090505b60018303811015612881576128418283610e0f565b9150600480548060010182816128579190612887565b916000526020600020900160005b84909190915090600019169055505b808060010191505061282c565b5b505050565b8154818355818115116128ae578183600052602060002091820191016128ad91906128b3565b5b505050565b6128d591905b808211156128d15760008160009055506001016128b9565b5090565b905600a165627a7a72305820c0c836b947ee2f799a35e3da374f3ae6aa4fce9a5de5ee171dda9db23a3aa10e00296060604052341561000c57fe5b5b618801600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550618802600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550618803600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550618804600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b6109b38061012a6000396000f30060606040523615610060576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633319f70b14610079578063794f69e3146100c0578063dafca47a1461015e578063e088659e146101ce575b341561006857fe5b6100775b61007461023e565b5b565b005b341561008157fe5b6100a260048080359060200190820180359060200191909192905050610246565b60405180826000191660001916815260200191505060405180910390f35b34156100c857fe5b6101446004808035906020019082018035906020019190919290803560001916906020019091908035600019169060200190919080356000191690602001909190803560001916906020019091908035600019169060200190919080356000191690602001909190803560001916906020019091905050610327565b604051808215151515815260200191505060405180910390f35b341561016657fe5b6101b460048080359060200190820180359060200191909192908035600019169060200190919080356000191690602001909190803567ffffffffffffffff16906020019091905050610561565b604051808215151515815260200191505060405180910390f35b34156101d657fe5b61022460048080359060200190820180359060200191909192908035600019169060200190919080356000191690602001909190803567ffffffffffffffff16906020019091905050610763565b604051808215151515815260200191505060405180910390f35b60006000fd5b565b600061025760408484905014610965565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633a27652384846000604051602001526040518363ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001828103825284848281815260200192508082843782019150509350505050602060405180830381600087803b151561030757fe5b60325a03f1151561031457fe5b5050506040518051905090505b92915050565b600060006000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16635286a75b8d8d8d8d8d8d8d8d8d6000604051602001526040518a63ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001896000191660001916815260200188600019166000191681526020018760001916600019168152602001866000191660001916815260200185600019166000191681526020018460001916600019168152602001836000191660001916815260200182810382528b8b8281815260200192508082843782019150509a5050505050505050505050602060405180830381600087803b151561044d57fe5b60325a03f1151561045a57fe5b50505060405180519050915081600060208110151561047557fe5b1a7f010000000000000000000000000000000000000000000000000000000000000002905060007f010000000000000000000000000000000000000000000000000000000000000002817effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614156104f05760009250610552565b60017f010000000000000000000000000000000000000000000000000000000000000002817effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614156105465760019250610552565b5b6105516000610976565b5b50509998505050505050505050565b600060006000600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634e32026389898989896000604051602001526040518663ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001856000191660001916815260200184600019166000191681526020018367ffffffffffffffff1667ffffffffffffffff168152602001828103825287878281815260200192508082843782019150509650505050505050602060405180830381600087803b151561065357fe5b60325a03f1151561066057fe5b50505060405180519050915081600060208110151561067b57fe5b1a7f010000000000000000000000000000000000000000000000000000000000000002905060007f010000000000000000000000000000000000000000000000000000000000000002817effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614156106f65760009250610758565b60017f010000000000000000000000000000000000000000000000000000000000000002817effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916141561074c5760019250610758565b5b6107576000610976565b5b505095945050505050565b600060006000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634e32026389898989896000604051602001526040518663ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001856000191660001916815260200184600019166000191681526020018367ffffffffffffffff1667ffffffffffffffff168152602001828103825287878281815260200192508082843782019150509650505050505050602060405180830381600087803b151561085557fe5b60325a03f1151561086257fe5b50505060405180519050915081600060208110151561087d57fe5b1a7f010000000000000000000000000000000000000000000000000000000000000002905060007f010000000000000000000000000000000000000000000000000000000000000002817effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614156108f8576000925061095a565b60017f010000000000000000000000000000000000000000000000000000000000000002817effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916141561094e576001925061095a565b5b6109596000610976565b5b505095945050505050565b8015156109725760006000fd5b5b50565b8015156109835760006000fd5b5b505600a165627a7a723058205399d16d877294bcc573c644dbb31d70202ea9493191890e5fe6e680ed0451810029'

// =================================
// END: Web3 
// =================================

function _demo_create_atumToken(tokenName, initialSupply) {
    // =================================
    // START: Web3 deploy code
    // =================================
    //console.log("Deploying atumToken with bytecode ending with : " + code.substring((code.length-20), code.length ));
    var atumToken = atumToken_abi.new(
        initialSupply,
        tokenName,
        {
            from: web3.eth.accounts[0],
			data: code,
            gas: '59700000' // changed
        }, function (e, contract) {
            console.log(e)
            //console.log(e, contract);
            if (typeof contract.address !== 'undefined') {
                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
            }
        })
    // =================================
    // END: Web3 deploy code
    // =================================
    return atumToken;
}

function _demo_get_atumToken(a) {
    return atumToken_abi.at(a)
}

function _demo_watch_events(c) {

	var events = c.allEvents();

	events.watch(function(error, result){
	    if (error) {
	    	return error;
	    } else {
	    	
	 		if (result.event =="LogShielding"){

	 			if ((result.args.uuid in tracker.notes)) {
		                console.log("[*] Shielding added to z-contract.");
		                console.log("***************************************************************");
		                console.log("note uuid : " + result.args.uuid);
		 			}

				} else if (result.event =="LogUnshielding") {

					if ((result.args.uuid in tracker.notes)) {
		                console.log("[*] Unshielding added to z-contract.");
		                console.log("***************************************************************");

		                var note = tracker.notes[result.args.uuid];
		                tracker.spent[note.uuid] = note;
		                delete (tracker.notes[note.uuid]);
	            }

			} else if (result.event =="LogShieldedTransfer") {

				web3.zsl.NoteDecrypt(tracker.keypair.a_sk,result.args.blob, function(err,result){
					if (!err){
		                console.log("[*] Incoming funds! amount : " + result.value + " " + c.name());
		                console.log("***************************************************************");

					    var value = parseInt(result.value);
					    var cm = web3.zsl.getCommitment("0x"+result.out_rho_1, tracker.keypair.a_pk, value);
					    var note = {};
					    
					    note.rho = "0x" + result.out_rho_1;
					    note.value = value;
					    note.ztoken = c.address;
					    note.uuid = web3.toHex(web3.sha3(cm, { encoding: 'hex' }));
						tracker.notes[note.uuid] = note;
					}
				});
			}	        
	    }
	});
	return true;
}

// Namespace for demo, using module pattern.
var demo = (function() {
    return {
    	init: function(){
    		tracker =  new ztracker() ;
    		console.log("Tracker successfully initialized.")
    		return  tracker ;
    	},
    	demo_tracker : function(){
    		return 
    	}
        create_atumToken: function(tokenName, initialSupply) {
            return _demo_create_atumToken(tokenName, initialSupply);
        },
        get_atumToken: function(a) {
            return _demo_get_atumToken(a);
        },
        watch_events: function(c){
        	return _demo_watch_events(c);
        },
    };	
})();


// Note tracker
function ztracker() {
    this.keypair = zsl.GenerateZKeypair();
    this.notes 	 = {};
    this.spent 	 = {};
}

ztracker.prototype.shield = function (atumToken, value) {

    var rho = zsl.getRandomness();
    var pk  = tracker.keypair.a_pk;

    console.log("***************************************************************");
    console.log("[*] Generating proof for shielding");

    var start   = new Date();
    var result  = zsl.createShielding(rho, pk, value);
    var elapsed = new Date() - start;

    console.log("[*] Generated in " + elapsed / 1000 + " secs");

    var uuid 	= web3.toHex(web3.sha3(result.cm, { encoding: 'hex' }));
    var events  = atumToken.allEvents();

    var note 			= {};
    note.rho 			= rho;
    note.value			= value;
    note.uuid 			= uuid;
    note.atumToken 		= atumToken.address;
    tracker.notes[uuid] = note;

    atumToken.shield(result.proof, result.send_nf, result.cm, value, { from: eth.accounts[0], gas: 350000 });
    return "Waiting for log event...";
}


ztracker.prototype.unshield = function (uuid) {

    var note 	= tracker.notes[uuid];
    var a 	 	= note.atumToken;
    var atumToken  = atumToken_abi.at(a);

    var cm        = zsl.getCommitment(note.rho, tracker.keypair.a_pk, note.value);
    var witnesses = atumToken.getWitness(cm)
    var treeIndex = parseInt(witnesses[0])
    var authPath  = witnesses[1]

    console.log("***************************************************************");
    console.log("[*] Generating proof for unshielding");

    var start = new Date();
    var result = zsl.createUnshielding(note.rho, tracker.keypair.a_sk, note.value, treeIndex, authPath)
    var elapsed = new Date() - start;
    console.log("[*] Generated in " + elapsed / 1000 + " secs");


    var rt = atumToken.root();
    atumToken.unshield(result.proof, result.spend_nf, cm, rt, note.value, { from: eth.accounts[0], gas: 350000 })
    return "Waiting for log event...";
}


ztracker.prototype.sendNote = function(atumToken, uuid, amount, shieldedAddress) {

    var blob = null;
    var empty_uncles = ["0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100", "0x8000000000000000000000000000000000000000000000000000000000000100"];
    var note = tracker.notes[uuid];

    if (note === undefined || note == null && typeof note !== 'object') {
        console.log(" fatal error with note, skipping.");
        return;
    }
    

    if (note.value < amount) {
        console.log("Cannot transfer " + amount + " as note value of " + note.value + " is too small.");
        return;
    }

    var pk  = tracker.keypair.a_pk;
    var sk  = tracker.keypair.a_sk;

    var change     = note.value - amount;

    var cm         = web3.zsl.getCommitment(note.rho, pk, note.value);
    var witnesses  = atumToken.getWitness(cm);
    var treeIndex  = parseInt(witnesses[0]);
    var authPath   = witnesses[1];

    var tmpKeypair = web3.zsl.GenerateZKeypair();
    var out_rho_1  = web3.zsl.getRandomness();
    var out_rho_2  = web3.zsl.getRandomness();

    console.log("***************************************************************");
    console.log("[*] Generating proof for shielded transfer");

    var start = new Date();

    web3.zsl.createShieldedTransfer(
        note.rho,
        sk,
        note.value,
        treeIndex,
        authPath,
        web3.zsl.getRandomness(),
        tmpKeypair.a_sk,
        0,
        0,
        empty_uncles,
        out_rho_1,
        shieldedAddress,
        amount,
        out_rho_2,
        pk,
        change,
        function(error, result) {

            if (!error) {

                var elapsed = new Date() - start;
                console.log("[*] Generated in " + elapsed / 1000 + " secs");

                blob = result.blob;

                var n1 = {};
                n1.value  = amount;
                n1.rho    = out_rho_1;
                n1.uuid   = web3.toHex(web3.sha3(result.out_cm_1, {
                    encoding: 'hex'
                }));
                n1.atumToken = atumToken.address;

                console.log("[*] Recipient receives note of " + amount + " " + atumToken.name());

                var n2 = {};

                if (change > 0) {
                    n2.value  = change;
                    n2.rho    = out_rho_2;
                    n2.uuid   = web3.toHex(web3.sha3(result.out_cm_2, {
                        encoding: 'hex'
                    }));
                    n2.atumToken = atumToken.address;
                	console.log("[*] Sender receives change of " + change + " " + atumToken.name());
                }


                console.log("[*] Submit shielded transfer to contract...");

                var anchor = atumToken.root();

                atumToken.shieldedTransfer(
                    result.proof, anchor,
                    result.in_spend_nf_1,
                    result.in_spend_nf_2,
                    result.out_send_nf_1,
                    result.out_send_nf_2,
                    result.out_cm_1,
                    result.out_cm_2,
                    blob, {
                        from: eth.accounts[0],
                        gas: 2470000

                    },
                    function(error, result) {
                        if (!error) {

						    var events = atumToken.allEvents();

						    events.watch(function (error, event) {
						        if (!error) {
						            var s = JSON.stringify(event.args);
						            if (event.event == 'LogShieldedTransfer' && event.args['uuid_1'] == n1.uuid ) {

						                console.log("[*] Shielded-transfer added to contract.");
						                console.log("***************************************************************");

						                tracker.spent[uuid] = note;
						                delete (tracker.notes[uuid]);
						                if ( change > 0) {
							                tracker.notes[n2.uuid] = n2;
						                } 
						                events.stopWatching();
						            }
						        }
						    });

                        } else {
                            console.log(err);
                        }
                    });

            } else {
                console.log(error);
            }
        });

    return "Waiting for log event...";

}

ztracker.prototype.list = function (atumToken, amount) {

    var result = [];
    var name   = atumToken.name();
    var addr   = atumToken.address;

    if (amount == undefined) {
        amount = 0;
    }

    for (var uuid in this.notes) {
        var note = this.notes[uuid];
        if (addr == note.atumToken && (note.value >= amount)) {
            result.push(note);
        }
    }

    console.log("***************************************************************");
    console.log("Found " + result.length + " " + name + " notes >= " + amount)
    console.log(JSON.stringify(result, null, 4))
    console.log("***************************************************************");
}


ztracker.prototype.balance = function (atumToken) {

    var result = 0;
    var name   = atumToken.name();
    var addr   = atumToken.address;

    for (var uuid in this.notes) {
        var note = this.notes[uuid];
        if (addr == note.atumToken) {
            result += note.value;
        }
    }

    console.log("***************************************************************");
    console.log("Shielded balance of " + name + " = " + result);
    console.log("***************************************************************");
}

// Basic persistence of tracker for demo purposes.
ztracker.prototype.load = function (filename) {

    var result = JSON.parse(zsl.loadTracker(filename));

    this.keypair = result.keypair;
    this.notes 	 = result.notes;
    this.spent 	 = result.spent;

    return true;
}

// TODO: Post-demo, filename should be sanitized.
ztracker.prototype.save = function (filename) {
    return zsl.saveTracker(filename, JSON.stringify(this))
}
